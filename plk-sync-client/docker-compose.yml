services:
  sync-client:
    image: python:3.13-slim
    container_name: sync-client
    volumes:
      - .:/app:ro
    env_file:
      - .env
    environment:
      - TZ=Asia/Bangkok
    command: sh -c "pip install --quiet -r /app/requirements.txt && python /app/sync_client.py sync_test.sql && tail -f /dev/null"
    restart: unless-stopped

  ofelia:
    image: mcuadros/ofelia:latest
    container_name: ofelia
    command: daemon --docker
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - TZ=Asia/Bangkok
    restart: unless-stopped
    labels:
      # Sync jobs - every day at scheduled times (30 min intervals starting 17:30)
      ofelia.job-exec.sync-bed-an-occupancy.schedule: "30 17 * * *"
      ofelia.job-exec.sync-bed-an-occupancy.container: "sync-client"
      ofelia.job-exec.sync-bed-an-occupancy.command: "python /app/sync_client.py sync_bed_an_occupancy.sql"
      
      ofelia.job-exec.sync-bed-type-all.schedule: "0 18 * * *"
      ofelia.job-exec.sync-bed-type-all.container: "sync-client"
      ofelia.job-exec.sync-bed-type-all.command: "python /app/sync_client.py sync_bed_type_all.sql"
      
      ofelia.job-exec.sync-critical-wait-bed.schedule: "30 18 * * *"
      ofelia.job-exec.sync-critical-wait-bed.container: "sync-client"
      ofelia.job-exec.sync-critical-wait-bed.command: "python /app/sync_client.py sync_critical_wait_bed.sql"
      
      ofelia.job-exec.sync-drgs-rw-top10.schedule: "0 19 * * *"
      ofelia.job-exec.sync-drgs-rw-top10.container: "sync-client"
      ofelia.job-exec.sync-drgs-rw-top10.command: "python /app/sync_client.py sync_drgs_rw_top10.sql"
      
      ofelia.job-exec.sync-drgs-sum.schedule: "30 19 * * *"
      ofelia.job-exec.sync-drgs-sum.container: "sync-client"
      ofelia.job-exec.sync-drgs-sum.command: "python /app/sync_client.py sync_drgs_sum.sql"
      
      ofelia.job-exec.sync-icu-semi-icu-case-realtime.schedule: "0 20 * * *"
      ofelia.job-exec.sync-icu-semi-icu-case-realtime.container: "sync-client"
      ofelia.job-exec.sync-icu-semi-icu-case-realtime.command: "python /app/sync_client.py sync_icu_semi_icu_case_realtime.sql"
      
      ofelia.job-exec.sync-icu-ward-death.schedule: "30 20 * * *"
      ofelia.job-exec.sync-icu-ward-death.container: "sync-client"
      ofelia.job-exec.sync-icu-ward-death.command: "python /app/sync_client.py sync_icu_ward_death.sql"
      
      ofelia.job-exec.sync-mortality-ami.schedule: "0 21 * * *"
      ofelia.job-exec.sync-mortality-ami.container: "sync-client"
      ofelia.job-exec.sync-mortality-ami.command: "python /app/sync_client.py sync_mortality_ami.sql"
      
      ofelia.job-exec.sync-mortality-sepsis.schedule: "30 21 * * *"
      ofelia.job-exec.sync-mortality-sepsis.container: "sync-client"
      ofelia.job-exec.sync-mortality-sepsis.command: "python /app/sync_client.py sync_mortality_sepsis.sql"
      
      ofelia.job-exec.sync-normal-ward-death.schedule: "0 22 * * *"
      ofelia.job-exec.sync-normal-ward-death.container: "sync-client"
      ofelia.job-exec.sync-normal-ward-death.command: "python /app/sync_client.py sync_normal_ward_death.sql"
      
      ofelia.job-exec.sync-or-utilization-rate.schedule: "30 22 * * *"
      ofelia.job-exec.sync-or-utilization-rate.container: "sync-client"
      ofelia.job-exec.sync-or-utilization-rate.command: "python /app/sync_client.py sync_or_utilization_rate.sql"
      
      ofelia.job-exec.sync-refer-paperless.schedule: "0 23 * * *"
      ofelia.job-exec.sync-refer-paperless.container: "sync-client"
      ofelia.job-exec.sync-refer-paperless.command: "python /app/sync_client.py sync_refer_paperless.sql"
      
      ofelia.job-exec.sync-refer-top10.schedule: "30 23 * * *"
      ofelia.job-exec.sync-refer-top10.container: "sync-client"
      ofelia.job-exec.sync-refer-top10.command: "python /app/sync_client.py sync_refer_top10.sql"
      
      ofelia.job-exec.sync-waiting-time-cataract.schedule: "0 0 * * *"
      ofelia.job-exec.sync-waiting-time-cataract.container: "sync-client"
      ofelia.job-exec.sync-waiting-time-cataract.command: "python /app/sync_client.py sync_waiting_time_cataract.sql"
      
      ofelia.job-exec.sync-waiting-time-hernia.schedule: "30 0 * * *"
      ofelia.job-exec.sync-waiting-time-hernia.container: "sync-client"
      ofelia.job-exec.sync-waiting-time-hernia.command: "python /app/sync_client.py sync_waiting_time_hernia.sql"